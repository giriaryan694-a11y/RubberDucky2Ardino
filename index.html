<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RubberDucky → Arduino C Converter</title>
<style>
body { background:#121212; color:#00ff00; font-family:monospace; padding:20px; }
textarea { width:100%; height:200px; background:#000; color:#0f0; border:1px solid #0f0; padding:10px; margin-bottom:10px; }
button { background:#0f0; color:#000; padding:10px 20px; border:none; cursor:pointer; font-weight:bold; margin:5px; }
pre { background:#000; border:1px solid #0f0; padding:10px; overflow-x:auto; }
footer { margin-top:20px; font-size:14px; color:#0f0; text-align:center; }
</style>
</head>
<body>
<h1>RubberDucky → Arduino C Converter</h1>

<label>Paste your Rubber Ducky script below:</label>
<textarea id="duckScript" placeholder="DELAY 1000&#10;GUI r&#10;STRING Hello&#10;ENTER"></textarea>

<div>
  <button onclick="convertScript()">Convert to Arduino C</button>
  <button onclick="downloadINO()">Download .ino File</button>
  <button onclick="copyCode()">Copy Code</button>
  <button onclick="pasteCode()">Paste into Duck Script</button>
</div>

<h2>Generated Arduino C Code:</h2>
<pre id="arduinoCode">// Your converted code will appear here...</pre>

<footer>Made by Aryan Giri</footer>

<script>
function convertScript() {
    const duck = document.getElementById('duckScript').value.split('\n');
    let output = `#include <DigiKeyboard.h>\n\nvoid setup() {\n  // Begin typing\n  DigiKeyboard.update();\n\n`;

    duck.forEach(line => {
        line = line.trim();
        if (!line) return;

        let comment = `  // ${line}\n`;

        // Handle DELAY
        if (line.startsWith('DELAY')) {
            let ms = line.split(' ')[1];
            output += comment + `  DigiKeyboard.delay(${ms});\n`;
        }
        // Handle STRING
        else if (line.startsWith('STRING')) {
            let text = line.slice(7);
            output += comment + `  DigiKeyboard.print("${text}");\n`;
        }
        // Handle ENTER/TAB
        else if (line === 'ENTER') output += comment + `  DigiKeyboard.sendKeyPress(KEY_ENTER);\n`;
        else if (line === 'TAB') output += comment + `  DigiKeyboard.sendKeyPress(KEY_TAB);\n`;

        // Handle GUI, ALT, CTRL, SHIFT combos
        else if (/^(GUI|ALT|CTRL|SHIFT)/.test(line)) {
            let parts = line.split(' ');
            let key = parts.pop().toUpperCase();
            let mods = parts.map(m => `MOD_${m.toUpperCase()}`).join(' | ') || '0';
            output += comment + `  DigiKeyboard.sendKeyStroke(KEY_${key}, ${mods});\n`;
        }
        else {
            output += comment + `  // Unsupported command, handle manually\n`;
        }
    });

    output += `}\n\nvoid loop() {\n  // Nothing here\n}\n`;

    document.getElementById('arduinoCode').textContent = output;
}

// Download .ino file
function downloadINO() {
    const code = document.getElementById('arduinoCode').textContent;
    const blob = new Blob([code], {type: "text/plain"});
    const link = document.createElement("a");
    link.download = "RubberDuckyPayload.ino";
    link.href = URL.createObjectURL(blob);
    link.click();
}

// Copy generated code to clipboard
function copyCode() {
    const code = document.getElementById('arduinoCode').textContent;
    navigator.clipboard.writeText(code).then(() => alert("Code copied to clipboard!"));
}

// Paste code from clipboard into Rubber Ducky textarea
function pasteCode() {
    navigator.clipboard.readText().then(text => {
        document.getElementById('duckScript').value = text;
    }).catch(() => alert("Failed to read clipboard."));
}
</script>
</body>
</html>
